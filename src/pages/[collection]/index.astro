---
import { type CollectionName } from "@/content.config";
import { site } from "@/constants";
import { getCollectionStaticPaths } from "@/lib/astro";
import { getAllCollectionsByCategory } from "@/lib/collections";
import { LayoutCollection, LayoutSingle } from "@/layout";

export { getCollectionStaticPaths as getStaticPaths };

const { collection } = Astro.params;
const entries = (await getAllCollectionsByCategory())[collection];
const meta = site.pages[collection as CollectionName];
const entriesPerPage = meta.entriesPerPage;

if (!entries) {
    return Astro.redirect("/");
}

const onlyOnePage =
    entries.length === 1 &&
    entries.some(({ data }: { data: any }) => data.index === true);
---

{
    onlyOnePage && entries && (
        <LayoutSingle {collection} entryId={entries[0].id} />
    )
}

{
    !onlyOnePage && entries && (
        <LayoutCollection
            {collection}
            {entries}
            {meta}
            {entriesPerPage}
            page={1}
            isIndex
        />
    )
}
