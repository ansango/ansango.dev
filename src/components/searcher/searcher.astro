---
import Search from "astro-pagefind/components/Search";
import { SearcherIcon } from "@/components";
import Script from "./searcher.script.astro";
---

<Script />
<button
  id="searcher-button"
  aria-label="(Press / to open search)"
  aria-describedby="searcher"
>
  <SearcherIcon />
  <kbd>
    <span> / </span>
  </kbd>
</button>

<dialog id="searcher-dialog">
  <div id="searcher-dialog-frame">
    <Search
      id="searcher"
      uiOptions={{
        showImages: false,
        showSubResults: true,
        resetStyles: true,
        translations: {
          clear_search: "",
        },
      }}
    />
  </div>
</dialog>

<style is:global>
  @reference "@/styles/global.css";

  :root {
    --pagefind-ui-scale: 0.8;
    --pagefind-ui-primary: var(--color-accent);
    --pagefind-ui-text: var(--color-content);
    --pagefind-ui-background: var(--pagefind-background);
    --pagefind-ui-border: var(--color-divider);
    --pagefind-ui-tag: var(--color-accent);
    --pagefind-ui-border-width: 2px;
    --pagefind-ui-border-radius: 28px;
    --pagefind-ui-image-border-radius: 8px;
    --pagefind-ui-image-box-ratio: 3 / 2;
    --pagefind-ui-font: var(--font-sans);
    --pagefind-ui-scale: 0.7;
  }

  :root.dark {
    #searcher-dialog-frame {
      color-scheme: dark;
    }
  }

  #searcher-shortcut {
    @apply flex items-center;
  }

  #searcher-button {
    @apply cursor-pointer focus:outline-none px-1 py-0.5;
    @apply sm:inline-flex sm:items-center sm:gap-1 sm:rounded-full  sm:inset-ring-muted/5 sm:hover:bg-muted/5 sm:border-divider sm:border;
    kbd {
      @apply leading-none hidden sm:inline-flex gap-0.5 text-xs text-muted rounded-full px-1 py-0.5;

      span {
        @apply mt-0.5;
      }
    }
  }

  #searcher-dialog {
    @apply backdrop:fixed backdrop:size-full backdrop:backdrop-blur-md bg-transparent;
    @apply size-full overflow-hidden max-w-[60ch];
    @apply fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-4;
  }

  #searcher-dialog-frame {
    @apply h-max max-h-[calc(100vh-40px)] overflow-y-auto mx-auto;
    @apply rounded-xl;
  }

  #searcher {
    .pagefind-ui {
      @apply font-normal text-base;
    }

    .pagefind-ui__form,
    .pagefind-ui__drawer {
      @apply !bg-pagefind-body;
    }

    .pagefind-ui__form,
    .pagefind-ui__search-input {
      @apply rounded-xl;
    }

    .pagefind-ui__search-input {
      @apply font-normal focus:outline-none border-none;
    }

    .pagefind-ui__drawer {
      @apply p-4;
    }

    .pagefind-ui__form::before {
      @apply size-4 top-[calc(22px*var(--pagefind-ui-scale))];
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' fill-rule='evenodd' d='M18.319 14.433A8.001 8.001 0 0 0 6.343 3.868a8 8 0 0 0 10.564 11.976l.043.045l4.242 4.243a1 1 0 1 0 1.415-1.415l-4.243-4.242zm-2.076-9.15a6 6 0 1 1-8.485 8.485a6 6 0 0 1 8.485-8.485' clip-rule='evenodd'/%3E%3C/svg%3E");
    }

    .pagefind-ui__message {
      @apply text-sm text-muted pt-0 pb-2;
    }

    .pagefind-ui__result {
      @apply py-1 border-t-[1px];
    }

    .pagefind-ui__result:last-of-type{
      @apply border-b-[1px];
    }

    .pagefind-ui__button{
      @apply border-[1px] text-xs font-medium hover:bg-muted/10 hover:border-0;
    }

    .pagefind-ui__result-link {
      @apply font-semibold underline underline-offset-2 hover:text-link;
    }

    .pagefind-ui__result-excerpt {
      @apply text-xs text-muted line-clamp-1;
    }
  }
</style>
