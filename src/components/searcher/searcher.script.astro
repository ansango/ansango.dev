<script lang="ts" is:inline>
  const searcher = () => {
    const clearButton = document.querySelector(".pagefind-ui__search-clear");
    if (clearButton) {
      clearButton.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M6.225 4.811a1 1 0 0 0-1.414 1.414L10.586 12L4.81 17.775a1 1 0 1 0 1.414 1.414L12 13.414l5.775 5.775a1 1 0 0 0 1.414-1.414L13.414 12l5.775-5.775a1 1 0 0 0-1.414-1.414L12 10.586z"/></svg>';
    }

    const closeDialog = () => {
      const dialog = document.getElementById("searcher-dialog");
      dialog.close();
      document.body.classList.remove("overflow-hidden");
    };

    const onClick = (event) => {
      const dialogFrame = document.getElementById("searcher-dialog-frame");
      const isSearcherButton = event.target.id === "searcher-button";
      const isSearcherIcon = event.target.id === "searcher-icon";
      const isSearcherShorcut = event.target.id === "searcher-shortcut";
      if (isSearcherButton || isSearcherIcon || isSearcherShorcut) {
        return openDialog();
      }
      const isLink = "href" in (event.target || {});
      if (
        isLink ||
        (document.body.contains(event.target) &&
          !dialogFrame.contains(event.target))
      ) {
        closeDialog();
      }
    };

    const openDialog = () => {
      const dialog = document.getElementById("searcher-dialog");
      dialog.showModal();
      document.body.classList.add("overflow-hidden");
    };

    window.addEventListener("click", onClick);

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        e.preventDefault();
        closeDialog();
      }

      if (e.key === "/") {
        e.preventDefault();
        openDialog();
      }
    });
  };
  document.addEventListener("DOMContentLoaded", () => searcher());
  document.addEventListener("astro:after-swap", () => searcher());
</script>
